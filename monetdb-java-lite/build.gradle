buildscript {
  repositories {
    jcenter { url "http://jcenter.bintray.com/" }
  }
  dependencies {
    classpath 'com.github.jengelman.gradle.plugins:shadow:1.2.4'
  }
}

apply plugin: 'java'
apply plugin: 'com.github.johnrengelman.shadow'

group = 'nl.cwi.monetdb'
ext.packaging = 'jar'
version = '2.24'

sourceCompatibility = 1.8
targetCompatibility = 1.8

def urlFile = { url, name ->
  File file = new File("$buildDir/libs/${name}.jar")
  file.parentFile.mkdirs()
  if (!file.exists()) {
    new URL(url).withInputStream { downloadStream ->
      file.withOutputStream { fileOut ->
        fileOut << downloadStream
      }
    }
  }
  files(file.absolutePath)
}

dependencies {
  compile urlFile('https://www.dropbox.com/s/jihyyd6knu7lkx4/monetdb-jdbc-new-' + version + '.jar?dl=1', 'monetdb-jdbc-new-' + version)
}

task testJar(type: Jar) {
  manifest {
    attributes 'Description': 'MonetDBJavaLite JAR with JDBC compability'
  }
}

shadowJar {
  manifest {
    inheritFrom project.tasks.testJar.manifest
  }
  destinationDir = file("./buildshadow")
}

