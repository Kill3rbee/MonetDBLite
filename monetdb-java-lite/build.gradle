buildscript {
  repositories {
    jcenter {
      url "http://jcenter.bintray.com/"
    }
    mavenCentral()
  }
  dependencies {
    classpath 'com.github.jengelman.gradle.plugins:shadow:1.2.4'
    classpath group: 'com.layer', name: 'gradle-git-repo-plugin', version: '2.0.2'
  }
}

apply plugin: 'java'
apply plugin: 'com.github.johnrengelman.shadow'
apply plugin: 'maven-publish'
apply plugin: 'git-repo'

version = '2.24'
sourceCompatibility = 1.8
targetCompatibility = 1.8

dependencies {
  compile fileTree(dir: 'libs', include: '*.jar')
  runtime fileTree(dir: 'libs', include: '*.jar')
}

task testJar(type: Jar) {
  manifest {
    attributes 'Description': 'MonetDBJavaLite JAR with JDBC compability'
  }
}

shadowJar {
  manifest {
    inheritFrom project.tasks.testJar.manifest
  }
}

repositories {
  github("hannesmuehleisen", "MonetDBLite", "Dec2016LiteJava", "releases")
}

gitPublishConfig {
    org = "hannesmuehleisen"
    repo = "MonetDBLite"
}

gitRepoConfig {
    org = "hannesmuehleisen"
    repo = "MonetDBLite"
    gitUrl = "git@github.com:hannesmuehleisen/MonetDBLite.git"
    provider = "github.com"
    publishAndPushTask = "publishToGithub"
    publishTask = "publish"
    offline = false
}

def someFile = file('monetdb-java-lite-2.24-all.jar')

publishing {
    publications {
        all(MavenPublication) {
            from components.java

            artifact sourceJar {
                archives someFile
            }
        }
    }
    repositories {
        maven {
            url "file://${gitPublishConfig.home}/${gitPublishConfig.org}/${gitPublishConfig.repo}/releases"
        }
    }
}

